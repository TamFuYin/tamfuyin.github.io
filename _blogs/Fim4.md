---
layout: default
title: Fim4
permalink: /blog/fim4/
---

# Fim4 论文拜读

题意：给定一棵有 $n$ 个节点的 Trie，和一个长为 $m$ 的在 $[1,n]$ 的序列 $a$。每次询问给定一个模式串 $t$ 和 $L,R$，问 $t$ 在 $s_{a_L}s_{a_{L+1}}\cdots s_{a_R}$ 的出现次数。

如果能够建出 $s_{a_1}s_{a_2}\cdots s_{a_m}$，能不能在线做？

对其建 SAM，则它接受所有子串，把 $t$ 放上去跑一跑，就能找到 $t$ 对应节点。

考虑用线段树合并维护子树 endpos 位置，然后查询一下区间和即可。

然而这个母串的长度可能很大，考虑建 exSAM。

然而我们还规定了一个 $a$，怎么做？

考虑先求出 $\sum_{i=L}^Rc(t,s_{a_i})$ 这个是简单的，在 exSAM 上维护即可。

然后我们需要求出跨串的贡献。

枚举开始的串的位置，我们需要求出 $\sum_{i=L}^{R-1}c(t,s[\max(lp_i,rp_i-|t|+2),\min(rp_R,rp+|t|-1)]$。