---
layout: default
title: 决策单调性与四边形不等式
permalink: /blog/jue-ce-dan-diao-xing-yu-si-bian-xing-bu-deng-shi/
---

# 决策单调性与四边形不等式

在正睿听课听到的，虽然几乎没有听懂，但是今天正好碰到一道[题](https://qoj.ac/contest/1738/problem/9119)的题解里提到了 SMAWK 算法让我大吃一惊，原来这个其它人类也能用吗！所以打算学一下。

本文大体复制粘贴自[APIO2021 课件](https://github.com/1t5t/APIO2021-monge/blob/main/%E5%86%B3%E7%AD%96%E5%8D%95%E8%B0%83%E6%80%A7%E4%B8%8E%E5%9B%9B%E8%BE%B9%E5%BD%A2%E4%B8%8D%E7%AD%89%E5%BC%8F.pdf)。

记 $\min_i(A)$ 为最大的整数 $k$ 满足 $\forall 1\le j\le m,A_{i,j}\ge A_{i,k}$。

> $\min_i(A)$ 即为 $f_i$ 的最优决策。

称一个矩阵为<ruby>单调矩阵<rt>monotone matrix</rt></ruby>，如果 $\forall 1\le i<n,\min_i(A)\le\min_{i+1}(A)$。

> 即决策单调性

称一个矩阵为<ruby>完全单调矩阵<rt>totally monotone matrix</rt></ruby>，如果其所有子矩阵均为单调矩阵。

称一个矩阵满足<ruby>四边形不等式<rt>quadrangle inequality</rt></ruby>，如果 $\forall 1\le i_1\le i_2\le n,1\le j_1\le j_2\le m$ 均有 $A_{i_1,j_1}+A_{i_2,j_2}\le A_{i_1,j_2}+A_{i_2,j_1}$，亦称矩阵 $A$ 为<ruby>蒙日阵<rt>monge matrix</rt></ruby>。

一个经典结论是，只要考虑 $2\times 2$ 的连续子矩阵即可，即

- $A$ 满足四边形不等式当且仅当 $\forall 1\le i<n,1\le j<m$ 有 $A_{i,j}+A_{i+1,j+1}\le A_{i+1,j}+A_{i,j+1}$。

还有如下经典性质：

- 四边形不等式 $\implies$ 完全单调性和转置矩阵的完全单调性
- 给任意一行或任意一列加上常数 $c$，四边形不等式仍满足

考虑 DP：
$$
f_{i,j}=\min_{1\le k<j}f_{i-1,k}+w_{k,j}
$$

那么从 $f_{i-1}$ 转移到 $f_i$ 时，可以构造一个矩阵 $A$ 满足
$$
A_{x,y}=

\left\{
\begin{aligned}
&f_{i-1,y}+w_{y,x},&x>y\\
&\infin,&x\le y
\end{aligned}
\right.
$$

那么 $f_{i,x}=A_{x,\min_x(A)}$，熟悉的读者知道此时可以 整体二分，不熟悉的读者可以参考[noshi91 的博客](https://noshi91.hatenablog.com/entry/2023/02/18/005856)。

由于此时所有的 $f_{i-1}$ 都已事先确定，我们称之为离线决策单调性。

或者这样的 DP：
$$
f_i=\min_{1\le j<i}f_j+w_{j,i}
$$

此时同样可以构造蒙日阵，但是你只有算完了第 $i$ 行你才能知道第 $i$ 列的值，我们称之为在线决策单调性。

例题：[ZYB 的浏览计划](https://qoj.ac/problem/5363)

典型的离线决策单调性，整体二分时在已经处理好的信息的基础上操作，算是比较典的 trick 吧

称一个元素是冗余的，如果他不是行最小值。

二分栈法可以处理在线决策单调性。思想是：增量加入每一列 $i$，如果他不是冗余的，那必然存在一个行区间 $[l_i,r_i]$，使得 $\min_j(A)=i,\forall j\in[l_i,r_i]$。

注意这里维护的是**当前最优的**决策，因此你加入一列时，需要把一段后缀的最优决策更新为他。由于并不是整批的，所以需要二分，用一个栈来维护。

这个算法需要较快时间内访问 $A$ 中元素。

