---
layout: default
title: CF2154
permalink: /blog/cf2154/
---

## F

答案的数量级是 $\dbinom{2n}n=O(4^nn^{o(1)})$ 的，远远低于 $n!$，所以这实际上*不是*排列计数题，不需要过多考虑重复元素的信息。

先想一个判定算法。

首先可以断定 $p_1$ 要么为 $1$，要么为 $k$，所以我们分两种情况讨论。

不妨假设 $p_1$ 已确定，如果未确定可以化 $O(N)$ 的时间枚举一下。

对于 $p_1=k=1$，显然只包括 $p=(1,2,\dots,n)$ 这一情况。

对于 $p_1=k$，存在合法解，如果 $p$ 中已确定的所有 $\le k$ 的元素和 $>k$ 的元素分别按顺序排列。

由于已经确定分界线，所以其实比较好做。

对于未确定的元素，我们不妨看成对其黑白染色，不妨记 $s_i$ 表示前缀黑球个数。

然后对于以确定的元素，相当于要求某个 $s$ 等于某个值。

然后两两相邻的已钦定的 $s$ 之间，可以贡献一个组合数的答案。

对于 $p_1=1$，让我们把目光转向 $p_2$，我们发现他要么为 $2$，要么为 $k$，且此种情况下 $k=2$ 时只有顺列的情况是合法的……

依此类推，我们删去确定的极长的 $1,2,\dots$ 前缀，然后可以钦定一段，然后剩下的开头就是 $k$ 了。

你发现可以对每个 $k$，预处理一个后缀的答案，所以可以简单的做到 $O(n^2)$。

F2 要求我们做到 $\tilde O(n)$，也就是需要考虑动态修改 $k$ 时答案的变化。

你发现，除非给出的 $p$ 是顺序的，否则其实只有一种分割方案，只要找到位置最靠前的存在逆序对的点即可。

然后就做完了。