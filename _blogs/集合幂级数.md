---
layout: default
title: 集合幂级数
permalink: /blog/ji-he-mi-ji-shu/
---

这里的集合幂级数仅考虑子集卷积（不交并卷积）

$$
F_z(x)=\sum x^S z^{|S|}
$$

## 求导

有点神秘

$$
x^S=\sum_{v\in S} x^{S\backslash\{v\}}
$$

所以我们认为
$$
F'(x)=\sum_{S}x^S\sum_{v\notin S}f_{S\cup \{v\}}
$$

## exp

exp 定义为

$$
e^{F(x)}=\sum_{i\ge 0}\frac{F^i(x)}{i!}
$$

等式两边同时 FMT

$$
\begin{aligned}
\operatorname{FMT}(e^{F_z(x)})&=\sum_{i\ge 0}\frac{\operatorname{FMT}(F_z^i(x))}{i!}\\
&=\sum_{i\ge 0}\sum_{S}\frac{([x^S]\operatorname{FMT}(F_z(x)))^ix^S}{i!}\\
&=\sum_{S}x^Se^{([x^S]\operatorname{FMT}(F_z(x)))}\\
\end{aligned}
$$

其中 $[x^S]\operatorname{FMT}(F_z(x))$ 是长为 $O(n)$ 的形式幂级数。

显然这里的形式幂级数 exp 不是瓶颈，没必要写那个 $O(n\log^2 n)$ 的。

我们可以用 $(e^{A(x)})'=e^{A(x)}A'(x)$ 列出一个 $O(n^2)$ 的递推。

## ln

$$
\ln(1+F(x))=\sum_{i\ge 1}\frac{(-1)^{i-1}F^i(x)}{i}
$$

依然两边同时 FMT

$$
\begin{aligned}
\operatorname{FMT}(\ln(1+F_z(x)))&=\sum_{i\ge 1}\frac{(-1)^{i-1}\operatorname{FMT}(F_z^i(x))}{i}\\
&=\sum_{i\ge 1}\sum_{S}\frac{(-1)^{i-1}([x^S]\operatorname{FMT}(F_z(x)))^ix^S}{i}\\
&=\sum_{S}x^S\ln([x^S]\operatorname{FMT}(F_z(x)))\\
\end{aligned}
$$

ln 也是可以 $O(n^2)$ 算的，原理同上。