---
layout: default
title: IOI 2015 中国国家集训队互测
permalink: /blog/ioi-2015--zhong-guo-guo-jia-ji-xun-dui-hu-ce/
---

# 集训队互测 2015 选做

~~10 年前的题做起来真是毫无难度~~

## Round 1

### A. Robot

李超树板子？

### B. Marketing network

爆搜题

### C. Sone2

论 SA 的综合利用？

2,3 是 SA 板子的板子

4 等价于问两个区间有没有相差为一定值的点对，~~显然是不可做的~~

1 还是动态的，这怎么做？我们学过动态的字符串数据结构吗

串串题还是太神秘了。溜了溜了

## Round 2

### A. 最大异或和

线性基，但是维度与数组大小一个等级。

把 $a_i$ 视作大小为 $m$ 的行向量 $\bm a_i$，于是 $A=[\bm a_i]$ 为一个 $n$ 行 $m$ 列的矩阵 $A$，消元之后变成 $B$。

我们可以用一个 $n$ 行 $n$ 列的可逆矩阵刻画消元的过程，$PA=B$。

那么如果我们把一个 $\bm a_i$ 修改成了 $\bm a_i+\bm w$，那么 $B$ 会变成 $B+P\bm e_i\bm w$，其中 $\bm e_i$ 表示只有第 $i$ 行为 $1$ 的列向量。

也就是说，我们看到 $P$ 的第 $i$ 列，对于所有 $P_{j,i}=1$ 的 $j$，$B$ 的第 $j$ 行都要加上 $\bm w$。

我们找到 $w$ 的最高位 $w_{\max}$

对于 $B$ 的每一行，如果其主元 $\ge w_{\max}$，那么直接异或上去就好了。

否则，我们找到这样的位置的最小值，然后考虑用这一行去消其他这样的行的元。

每次操作 $O(nm/w)$，可行！

如果是区间操作，同样也是可以做的。用 bitset mask and 之后 popcount 即可。

对于区间覆盖操作，珂朵莉即可。

### B. 小树苗与集合

静态仙人掌邻域半群信息查询，这里边数即为时间复杂度，点数即为空间复杂度。

神秘

如果是树上，而且 $l=1$ 的话，就可以用 LHF 的长剖秒掉了。

思考一下，树上邻域信息除了长剖还有点分治，详见[震波](https://www.luogu.com.cn/problem/P6329)。

但是这道题没有信息减法，但是是离线的，所以需要每层搞一下前缀和和后缀和，用前缀和代替线段树即可。

复杂度一只 log

然而这道题是仙人掌，你发现也是可以点分治的。只需要判一下点分中心是圆点还是方点就行。

### C. 上帝之手

粉兔线段树

几乎是三合一了

#### 询问一

容易看出 $f[l,r]=\min_{i=l}^{r+1}\{l_{i-1}+s_r-s_{i-1}\}$ 其中 $s$ 为 $d$ 的前缀和。

你发现每个点的信息是一个后缀 min，所以直接取 $l=r-k+1$ 就好了。

#### 询问二

相当于求 $\max_i\{\min(x_0+s_r-s_{i-1},f[i+1,r])\}$

分讨一下，考虑什么时候有 $x_0+s_r-s_{i-1}<f[i+1,r]$，可以发现当且仅当 $s_{i-1}>x_0+s_r-f[i+1,r]$。

由于随着 $i$ 的减少，$s_{i-1}$ 减少，而 $-f[i+1,r]$ 增大，所以这个限制一定是越来越严的，换句话说，一定存在一个分界点，使得前面都满足 $\min$ 取右边，而后面都取左边。所以二分出分界点之后分开搞取 $\max$ 即可，然后你发现无论是前面还是后面，都一定是在分界点处取到最优，所以就做完了。

#### 询问三

数 $f[i,r]$ 有多少种，就是在问 $l_{i-1}+s_r-s_{i-1}$ 取到多少次后缀 min。

你仔细想想，发现是可以用**粉兔线段树**维护的。

我们设 $query(p,x)$ 表示询问线段树结点 $p$ 右边接一个最小值为 $x$ 的区间后能够贡献多少 后缀 min。

维护 $t[p]=query(p.ls,min[p.rs])$。

那么当我们询问 $query(p,x)$ 时：
- 如果 $x<min[p.rs]$，那么 $p.rs$ 被完全覆盖，返回 $query(p.ls,x)$
- 否则，返回 $t[p]+query(p.rs,x)$

## Round 3

### A. 胡策的统计

身为一个 2025 年的 OIer，你一定会做这道题

### B. 胡策的数列

$$
a_i=-\frac45a_{i-1}+\frac{12}{25}a_{i-2}\\
a_i=\frac{5a_1+6a_0}8\left(\frac 25\right)^i+\frac{-5a_1+2a_0}{8}\left(-\frac 65 \right)^i
$$

### C. 胡策的小树

随机游走

## Round 4

### A. 最优决策

#### type=1

金策的询问是最好搞的。

记状态 $(i,j)$ 时 Alice 的胜率为 $F(i,j)$，把它看成 $n^2$ 个变量。

记 Alice 在 $(i,j)$ 状态时选择决策 $k$ 的概率为 $A(i,j,k)$，Bob 为 $B(i,j,k)$，双方分别使用决策 $k$ 和决策 $l$ 时将转移到 $T(i,j,k,l)$。则
$$
F(必胜)=1\\
F(必败)=0\\
F(i,j)=\sum_k\sum_lA(i,j,k)B(i,j,l)F(T(i,j,k,l))
$$

所以有 $n^2$ 个变量，$n^2$ 个方程，可以直接高消解出来。

#### type=2

计策的询问。

注意到由于 Alice 的决策固定，所以 Bob 没必要按概率决策。换言之，必然存在一个最优决策，使得对于每个状态，Bob 都以 100% 的概率出某一个决策。

于是考虑迭代更新，每次 Bob 都用上一轮的最高胜率来更新这一轮的决策，再跑一遍 type=1，显然可以收敛到一个最优解。

#### type=3

决策的询问。

纳什均衡，现在两人可能以概率形式决策。

注意只要 Alice 的策略和胜率确定了，Bob 的策略也就确定了，因为 Bob 只要针对性地出就好了。

所以只要列 Alice 的策略和胜率即可。

但是仍然很难解，所以仍然需要迭代胜率。

由于胜率确定，所以每个状态的决策基本独立。

你发现形如一个线性规划，变量为 Bob 的决策概率及新的胜率。

~~其实没搞懂~~

### B. 未来程序·改

臭 名 昭 著

曾经尝试过

### C. 普罗达科特

好欸是数数题

> 回顾一下 Burnside 引理
>
> $$
> |X/G|=\frac 1{|G|}\sum_{g\in G}|X^g|
> $$
>
> 这里 $X^g=\{x\in X\mid gx=x\}$ 表示在 $g$ 的作用下的不动点集合。
>
> 证明：$|X/G|=\sum_{o\in X/G}1=\sum_{x\in X}\frac{1}{|Gx|}=\frac 1{|G|}\sum_{g\in G}|X^g|$
>
> 其中 $Gx$ 的意思是 $x$ 在 $G$ 的作用下的生成子群。第三个等号成立是因为 $\frac{|G|}{|Gx|}$ 即为使 $gx=x$ 的 $g$ 的个数，等号两边都统计了所有不动点对 $(g,x)$ 的个数。
>
> Polya 定理进一步针对排列优化了等式右边的计数，这是因为 $|X^g|=m^{\# c(g)}$，其中 $\# c(g)$ 表示 $g$ 的置换环个数，$m$ 表示颜色数。

首先你看到**不**整除 $M$ 的性质，这意味着你得搞一下容斥，设至少有 $m$ 个数整除 $M$。

我们先不考虑不带标号的性质，如果我们强行区分顺序，那么答案即为：
$$
\begin{aligned}
&\left[\prod_{i=1}^nz_i^{a_i}\right]\binom km\left(\prod_{i=1}^n\frac{1-z_i^{b_i+1}}{1-z_i}\right)^m\left(\prod_{i=1}^n\frac{1}{1-z_i}\right)^{k-m}\\
&=\left[\prod_{i=1}^nz_i^{a_i}\right]\binom km\prod_{i=1}^n(1-z_i^{b_i+1})^m(1-z_i)^{-k}\\
&=\binom km\prod_{i=1}^n[z^{a_i}](1-z^{b_i+1})^m(1-z)^{-k}\\
\end{aligned}
$$

不会做

## Round 5

### A. ydc的题面

这™是**一**道题吗！！！

未 来 程 序

### B. ydc 的字符串

澄清一下，这里称 $s$ 在 $t$ 中的出现次数，是在数 $a+s$，其中 $a\in[l,r]$，在 $t$ 中的出现次数。

找到 $t$ 的 SAM 中 $s$ 对应的结点。如果这个结点的 $\rm maxlen$ 要 $\ge |s|+1$，那么 $s$ 前面的字符只有一种，判以下行不行，如果行，就是这个结点的子树叶子数。否则，需要维护一段儿子区间的子树和。

操作 0：显然我们的 SAM 是支持增量的。仔细想想，我们需要维护如下操作：
- 加点
- 删边
- 加边
- 查询子树和

考虑用动态树维护，比如 ETT。而且我们的 ETT 也是支持对儿子排序并维护儿子区间子树和的。

操作 1：ETT 也是可持久化的。

操作 2、3：比较简单

### C. ydc的奖金

首先不妨把概率分布函数标准化，即 $\int_0^1f_i(x)\mathrm dx=1$。

如果只有两个人，那么 $1$ 的分数比 $2$ 小的概率为
$$
\int_{x=0}^1f_1(x)(\int_{y=x}^1f_2(y)\mathrm dy)\mathrm dx
$$

不妨记 $F_1(x)=\int f_1(x)+C$，$F_2(x)=\int f_2(x)+C$，其中保证 $F_1(0)=F_2(0)=0$

那么上式等于
$$
\begin{aligned}
&\int_{x=0}^1f_1(x)(F_2(1)-F_2(x))\mathrm dx\\
&=1-\int_{x=0}^1f_1(x)F_2(x)\mathrm dx\\
\end{aligned}
$$

钦定 $S\subseteq[1,n-1]\cap \Z$ 为分数比他小的人的集合，$\overline S$ 为比他大的。

那么概率为
$$
\begin{aligned}
&\int_{x=0}^1f_n(x)(\prod_{i\in S}\int_{y=0}^xf_i(y)\mathrm dy)(\prod_{i\in \overline S}\int_{y=x}^1f_i(y)\mathrm dy)\mathrm dx\\
&=\int_{x=0}^1f_n(x)(\prod_{i\in S}F_i(x))(\prod_{i\in \overline S}(1-F_i(x)))\mathrm dx
\end{aligned}
$$

我们只需要关注 $|S|$ 即可，所以不妨用一个多项式来记这个。

所以我们要求的就是
$$
\begin{aligned}
&\int_{x=0}^1f_n(x)\prod_{i=1}^{n-1}(F_i(x)z+1-F_i(x))\mathrm dx\\
&=\int_{x=0}^1f_n(x)\prod_{i=1}^{n-1}(F_i(x)(z-1)+1)\mathrm dx
\end{aligned}
$$

求出 $\prod_{i=1}^{n-1}(F_i(x)(z-1)+1)$ 用一个 DP 即可，可以用 NTT 做到 $nm\log m$，其中 $m=\sum t$。

