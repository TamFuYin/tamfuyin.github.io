---
layout: default
title: 四边形不等式学习笔记
permalink: /blog/si-bian-xing-bu-deng-shi-xue-xi-bi-ji/
---

# 四边形不等式学习笔记

**Definition 0.0（四边形不等式）.** 考虑代价函数 $w(l,r)$，若对于 $\forall a\le b\le c\le d$，s.t.$w(a,c)+w(b,d)\le w(a,d)+w(b,c)$ 则称 $w$ 满足四边形不等式。

**Definition 0.1（最小最优决策点）.** 记 $\mathrm{opt}(i)=\min\{k|\forall j,w(k,i)\le w(j,i)\}$。

**Lemma 0.0（决策单调性）.** 若 $w$ 满足四边形不等式，则 $\mathrm{opt}$ 单调不下降。事实上，这对于最大最优决策点亦成立。

*Proof.* 最优决策点集合未必是一个区间，因此如何比较两个最优决策点集合的大小关系？我们称 $A\le B$ 当且仅当 $\forall a\in A,b\in B$ 有 $\min(a,b)\in A$ 和 $\max(a,b)\in B$，换言之 $\max A\backslash B\le \min B\backslash A$，这蕴含了最小及最大的最优决策点的情况，证明这个加强的定理，只要证 $\forall b\in B$ 有 $b<\max A\implies b\in A$。不妨记 $i$ 的最优决策点集合为 $A$，$j(i<j)$ 的最优决策点为 $B$，记 $a=\max A$，则对于任意 $b\in B$ 中 $<a$ 的 $b$，满足四边形不等式 $w(b,j)+w(a,i)\ge w(b,i)+w(a,j)$，所以 $w(b,i)\le w(a,i)-(w(a,j)-w(b,j))\le w(a,i)$。$□$

##### 区间拆分问题

形如 $f(i)=\min_{j\le i} f(j-1)+w(j,i)$ 的 1D/1D 方程被称为区间拆分问题，其同样满足决策单调性。

想要证明这一点，只需要证明代价函数 $f(l-1)+w(l,r)$ 同样满足四边形不等式。显然这是可以约掉的。

##### 区间合并问题

形如 $f(l,r)=\min_{l\le k<r}f(l,k)+f(k+1,r)+w(l,r)$ 的 2D/1D 方程被称为区间合并问题。若 $w$ 除了四边形不等式还满足区间包含单调性 $w(b,c)\le w(a,d),\forall a\le b\le c\le d$，则 $f$ 满足决策单调性。

**Lemma 2.0。** $f(l,r)$ 满足四边形不等式。

*Proof.* 按 $d-a$ 的大小归纳。对 $i=\mathrm{opt}(a,d)$ 分类讨论：
若 $a\le i< b$，则
$$
\begin{aligned}f(a,d)+f(b,c)&=f(a,i)+f(i+1,d)+w(a,d)+f(b,c)\\&\ge f(i+1,c)+f(b,d)+f(a,i)+w(a,d)\\&\ge f(b,d)+f(a,i)+f(i+1,c)+w(a,c)\\&\ge f(a,c)+f(b,d)\end{aligned}
$$
$c\le i<d$ 的情况对称同理。
若 $b\le i<c$，不妨令 $j=\mathrm{opt}(b,c)\le i$ 则
$$
\begin{aligned}f(a,d)+f(b,c)&=f(a,i)+f(i+1,d)+f(b,j)+f(j+1,c)+w(a,d)+w(b,c)\\&\ge f(a,j)+f(j+1,c)+f(b,i)+f(i+1,d)+w(a,c)+w(b,d)\\&\ge f(a,c)+f(b,d)\end{aligned}
$$
$□$

**Theorem 2.0.** $f(l,r)$ 满足对于 $l$ 和 $r$ 都满足决策单调性，即 $\mathrm{opt}(l,r-1)\le\mathrm{opt}(l,r)\le\mathrm{opt}(l+1,r)$。固定 $i=l$，则只需证明 $f(i,l)+f(l+1,r)$ 满足四边形不等式。显然前一步部分是可以约掉的，而后一部分根据 **Lemma 2.0** 满足四边形不等式。$r$ 同理。