---
layout: default
title: 排列计数的新视角——键值配对
permalink: /blog/pai-lie-ji-shu-de-xin-shi-jiao--jian-zhi-pei-dui/
---

# 排列计数的新视角——键值配对

[广为人知的](https://www.cnblogs.com/kodoku/articles/18577493)，我们对排列计数有如下方法

- 转化为置换环
- 按键移动，在值中插入
- 按值移动，在键中插入

但是，第一种方法需要式子长得好看，第二种方法需要只比较值的相对大小关系，第三种方法需要只比较位置的相对关系。

对于[这道题](https://qoj.ac/contest/1699/problem/8529)，键与值相比较，又转化不了第一种方法，就比较困难。

当然，第一种方法强调不同元素的相互关系。对于这道题，我们只关注每个位置上的值，此时我们引入一个新方法——键值配对。

排列可以视作一个从键到值的双射。我们把键跟值分开来，按照大小排成一排：

<span style="color: red;">1</span> <span style="color: blue;">1</span> <span style="color: red;">2</span> <span style="color: blue;">2</span> <span style="color: red;">3</span> <span style="color: blue;">3</span> <span style="color: red;">4</span> <span style="color: blue;">4</span> <span style="color: red;">5</span> <span style="color: blue;">5</span> 

其中<span style="color: red;">红色</span>表示键，<span style="color: blue;">蓝色</span>表示值，那么排列即为红色与蓝色的匹配。

设 $f_{i,j}$ 表示已考虑了前 $i$ 个元素，其中已经产生了 $j$ 个匹配。

那么，我们知道目前有 $i-2j$ 个未被匹配的元素，且其中 $\lceil(i-2j)/2\rceil=\lceil i/2\rceil-j$ 个是红色的，$\lfloor i/2 \rfloor -j$ 个是蓝色的。

我们将在键与值中的较大者中产生匹配，这样方便我们处理键与值的比较大小关系。

在这道题中，我们还需要记录所有已产生的匹配的较大者的值之和。这样我们就能得到一个排列的 balance。这道题还需要我们钦定一些位置，显然也是可以做的。

