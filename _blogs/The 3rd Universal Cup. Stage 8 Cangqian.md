---
layout: default
title: The 3rd Universal Cup. Stage 8 Cangqian
permalink: /blog/the-3rd-universal-cup-stage-8-cangqian/
---

# The 3rd Universal Cup. Stage 8: Cangqian

## Bingo

其实 $N$ 放那么大是假的。

记 $N=10^{18}n'+n$，那么实际上我们只用关注 $n'\bmod m$ 和 $n$ 即可。

我们不妨记 $r\gets -n'\bmod m$。

首先先判一下 $n'$ 里面有没有包含 $M$ 这个子串，有的话直接 $x=10^{18}n'+n+r$。

否则枚举一下这个子串从哪里开始，然后相当于确定了一段前缀，也是可以做的。

## Simulated Universe

~~贪心宝宝题~~

铁 p，sigh

看错题了，获得「第一类奇物」还是「第二类奇物」是自己选的。

神秘 DP

注意到我们只关心有多少个 `B` 已被匹配。

设 $f_{i,j,k}=0/1$ 表示前 $i$ 个点中，还剩下 $j$ 个 `B` 未匹配，后面匹配了 $k$ 个 `B`，这种情况能否达到。

转移不难。

然后考虑互换值域/定义域，显然是匹配的 $k$ 越多越好，然后就能做到 $O(n^2)$。

## Challenge NPC

提交答案题。

其实你很难控制构造出的图的色数（如题目所说，这是一个 NPC 问题），所以不妨考虑构造一个二分图，使其色数尽量大。

这是不难的。

## Puzzle: Easy as Scrabble

这不直接填进去就行了？

## Team Arrangement

考虑一个很抽象的二分图匹配：左部是每个人，右部表示人数。

每个人连向一个区间的人数，要求度恰为 $1$；每个人数要求度数为它的倍数。

考虑如果确定了每个人数的度数，那么如何判断合法性。

考虑 Hall 定理，那么合法当且仅当：

- 对于每个人的子集，求出其区间之并，则度数之和皆 $\ge$ 人数。显然只有选出一个人数的区间时限制是最紧的，因此相当于要求对于每个人数的区间，其包含的人的个数皆 $\le$ 度数之和。
- 对于每个人数的子集，其所连人的个数皆 $\ge$ 度数之和。

因此我们发现对于每个人数的区间，其所有与其有交的人的个数等于度数之和。

## Stage: Agausscrab

签到

## Crawling on a Tree

记 $f_{u,i,j}$ 表示在以 $u$ 为根的子树中，进来 $i$ 只乌龟，出来 $j$ 只乌龟，的最小代价和。

但是不会做了。

我们先观察点性质。设 $x_i,y_i$ 表示节点 $i$ 进来 $x_i$ 只出来 $y_i$ 只，此时能否合法。

那么需要满足：

- $x_i\ge c_i$
- $x_i,y_i\le k_i$
- 

## Permutation

考虑每次找到次大值的位置 $p$，然后分别询问 $[l,p]$ 和 $[p,r]$，那么恰好会有一个返回 $p$，它包含最大值。然后递归到这个区间即可。

但是这种做法可能会被卡到询问次数 $O(N)$。

让我们来考虑**真正的二分**。

考虑询问 $[l,mid],[mid+1,r],[l,r]$，设其返回值分别为 $x,y,z$

- 如果最大值与次大值不在同一个区间，此时 $x\ne z,y\ne z$，此时递归到 $z$ 不在的区间即可。
- 否则最大值与次大值在同一个区间，此时递归到 $z$ 所在的区间即可。

## Piggy Sort

搜索即可

注意到「坐标之和」是一个关于 $t$ 的一次函数，所以其实是可以算出来每个照片的拍摄时间的。

然后搜出来一个点通过了所有照片的的对应点。

## Even or Odd Spanning Tree

考虑把所有边按照 $w$ 的奇偶性分类。

那么相当于要求奇权边用奇数/偶数次。

~~我会 LCT！建出偶权边的最小生成树，然后每次加入奇权边。~~

考虑记 $f(k)$ 表示使用 $k$ 条奇权边的答案，不难发现 $f$ 是凸函数，所以另一个答案一定是 $f(k-1)$ 或者 $f(k+1)$。

根据拟阵的性质，$f(k-1)$ 一定形如 $f(k)$ 的最小生成树删掉一条奇权边然后加入一条偶边得到。

## Sugar Sweet 3

乍看上去是 Stirling 数，但是细看发现 $x\le 10^9$？？？这能做。

## Challenge Matrix Multiplication

考虑 DAG 链剖分，发现原图至多剖成 60 条链。

然后我们只需要知道每个点最前能够抵达每条链的哪个位置即可。

## Triangles

水